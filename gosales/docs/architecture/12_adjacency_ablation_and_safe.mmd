---
title: GoSales Engine - Adjacency Ablation Triad and Auto‑SAFE
---

```mermaid
graph TB
    Start([Adjacency Ablation Start]) --> Inputs
    Inputs[Inputs: division, train_cutoff,
           holdout_cutoff, window_months] --> Variants

    subgraph "Train @ train_cutoff; Eval @ holdout_cutoff"
        Variants[Build Variants]
        Full[Full Features]
        NoRec[No Recency + Short Windows]
        SAFE[SAFE Policy (drop adjacency families)]
        FitSel[Fit LR & LGBM; select by holdout AUC]
        Compare[Compare Metrics
                AUC, Lift@K, Brier]
    end

    Variants --> Full --> FitSel --> Compare
    Variants --> NoRec --> FitSel
    Variants --> SAFE --> FitSel

    Compare --> Delta[Delta AUC<br/>Full − SAFE]
    Delta --> Artifacts[Write Artifacts
                         JSON, CSV]

    subgraph "Gating & Policy"
        Gate[Adjacency Gate
             if SAFE ≥ Full by ≥ ε → recommend SAFE]
        AutoSAFE[Auto‑SAFE Script
                 updates config.modeling.safe_divisions]
    end

    Delta --> Gate --> AutoSAFE
    Artifacts --> UI[UI Adjacency Ablation Viewer
                     table + ΔAUC]

    %% Styling
    classDef node fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef var fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef gate fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    class Inputs,FitSel,Compare,Delta,Artifacts,UI node
    class Variants,Full,NoRec,SAFE var
    class Gate,AutoSAFE gate
```

