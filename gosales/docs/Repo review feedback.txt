Plan of Attack: Updating SKU?Division Mapping and Code for GoSales Engine
Background
You have clarified how several SKUs and flags map to your product divisions and how some columns should be handled. We need to update the GoSales Engine ETL and feature logic so that divisions, aliases and “renewals” definitions align with your business understanding. The changes involve extending etl/sku_map.py, updating the build_star.py ETL, and adjusting the feature builder if necessary. The sections below provide step?by?step guidance for the GPT?5 coding agent to implement these updates.

1. SKU Alias & Division Mapping Updates
Make all changes in gosales/etl/sku_map.py (or whichever module defines SKU?division mappings and aliases).
1. Simulation SKUs
2. Sales_Log[Simulation] is GP for SOLIDWORKS?based simulation licenses.
3. Sales_Log[HV_Simulation] is GP for high?end simulation tools (SOLIDWORKS or SIMULIA).
4. Sales_Log[Combined Simulation] should be understood as a derived column (sum of the above two) and not a separate base SKU. Do not map it as its own division.
5. SW_Plastics_Qty should roll into Simulation; GP for plastics is accounted for in HV_Simulation. Map the quantity column SW_Plastics_Qty to the Simulation division.
6. Additive Manufacturing – Printer SKUs
7. Keep Fortus as a valid FDM printer SKU.
8. Alias the obsolete printer SKUs UPrint and _1200_Elite_Fortus250 into FDM. Remove them as separate keys.
9. Metals (e.g., Xact Metal, BLT) remain its own sub?division under Additive Manufacturing.
10. Post?Processing
11. Add a new sub?division under Additive Manufacturing called Post_Processing. Map columns Post_Processing and Post_Processing_Qty (if present) to this subdivision instead of bundling them with consumables or services.
12. Additive Manufacturing Software
13. _3DP_Software_Qty is poorly defined; treat it the same as AM_Software. Map _3DP_Software_Qty to the existing AM_Software division and do not create a new division.
14. Renewals (Virtual Division)
15. Drop columns ALC, PLC, YLC, YSC and their quantity counterparts from the Renewals virtual division. These charges are accounted for in other columns and will be ignored for now.
16. Ignore CPE_YXE_Renewals columns, as the values are blank/zero.
17. Keep the existing renewal indicators: UAP (Core_New_UAP, Pro_Prem_New_UAP and their qty), Success Plan GP/Success_Plan_Qty, Term GP, Term_Renewals and AM support (AM_Support).
18. Flags / Indicators
19. Treat ACR (“Account Change Request”) and New as boolean flags, mapped to every division. They should not be considered as SKUs but as binary features in the feature matrix.
20. DraftSight
21. DraftSight GP can be inferred from CGP and Misc GP/QTY columns. PLC/YLC GP/QTY also relate to DraftSight but are redundant; exclude PLC and YLC columns from feature engineering and SKU mapping. Map CGP, Misc and Misc_Qty as the DraftSight product line.
22. PLM / 3DEXPERIENCE
23. Introduce a new division called CPE (Commercial Platform & Engineering / PLM/3DEXPERIENCE). Use the value of 'CPE' in Sales_Log[Division] to identify rows belonging to this division.
24. Map the following SKUs to CPE: HV_Simulation/HV_Simulation_Qty, CATIA, Delmia_Apriso, and Delmia_Apriso_Qty. They should no longer be grouped with Simulation.

2. ETL and Feature Updates
1. Update SKU mapping logic
2. Modify the SKU?division map and alias map to reflect the above decisions. Ensure obsolete SKUs alias into FDM and UPrint/_1200_Elite_Fortus250 are dropped.
3. Add new entries for the Post_Processing subdivision and CPE division.
4. Adjust build_star.py
5. When unpivoting GP and quantity columns, consult the updated SKU map so that simulation plastics, obsolete printers and renewal columns are properly assigned.
6. For the new CPE division, when you populate the fact_transactions table, set product_division = 'CPE' for rows where the SKU is HV_Simulation, CATIA or Delmia_Apriso.
7. Continue joining with dim_customer and the industry enrichment table as before; the new divisions should flow through automatically.
8. Feature Engineering
9. In features/engine.py, ensure that quantity columns with no GP (e.g., SW_Plastics_Qty, some DraftSight qty columns) still contribute to seat?count features and renewal seat counts.
10. Add boolean features for ACR and New. These flags should be 1 if the transaction row has the flag set; aggregate them per customer (e.g., ever_new_customer and ever_acr) at the feature cutoff.
11. Modeling
12. No modeling changes are needed immediately, but you will need to train a new model for the CPE division once the ETL and features are updated.

3. Documentation & Testing
1. Update documentation
2. Revise gosales/docs/Sales_Log_Schema.md to reflect the new SKU categories (Simulation plastics, CPE division, Post?Processing). Note that ALC/PLC/YLC/YSC columns are dropped from Renewals.
3. Describe the new divisions in gosales/README.md and update any examples that mention the old mapping.
4. Tests
5. Update or write unit tests in tests/ to assert that:
o Obsolete printer SKUs alias to FDM.
o SW_Plastics_Qty appears under Simulation counts.
o Renewals features exclude ALC/PLC/YLC/YSC columns.
o HV_Simulation, CATIA, and Delmia_Apriso rows are classified as CPE.
6. Run the pipeline end?to?end
7. Execute Phase?0 through Phase?3 on a small sample dataset with the updated mapping to verify that counts and revenue totals per division align with expectations.

4. Implementation Tips
* Keep the SKU map as a declarative dictionary; this makes it easy to audit and modify in the future.
* Use aliasing in the ETL to handle legacy names and to convert obsolete SKUs into their current equivalents.
* When adding new divisions (like CPE and Post_Processing), make sure to update any enumeration of division_set() functions so that the pipeline automatically picks up the new divisions for modeling and scoring.
* Document the reasoning inline where possible so other developers understand why certain columns were excluded (e.g., ALC charges) or why they roll up to a particular division.

Summary
This plan updates the product division and SKU mapping based on your clarifications. The key changes involve: rolling plastics into Simulation; aliasing obsolete printers to FDM; separating Post?Processing items; maintaining Metals as its own sub?division; creating a new CPE division for PLM/3DEXPERIENCE products; ignoring ambiguous or redundant renewal columns (ALC/PLC/YLC/YSC and CPE_YXE_Renewals); treating ACR and New as boolean indicators; and properly mapping DraftSight revenue. Implement these changes in the SKU mapping, ETL, feature engineering, and documentation to ensure your GoSales Engine reflects the latest business logic.

